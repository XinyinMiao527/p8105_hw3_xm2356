---
title: "p8105_hw3_xm2356"
author: "Xinyin Miao (xm2356)"
date: "2025-10-06"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  warning = FALSE,
  message = FALSE,
  fig.width = 8,
  fig.height = 6 )
```

```{r}
library(tidyverse)
```

# Problem 1
```{r}
library(p8105.datasets)
data("instacart")
```

The instacart dataset is a large dataframe containing `r nrow(instacart)` observations and `r ncol(instacart)` variables. Each observation represents a single item within a customer's order. Key variables include:

order_id: A unique identifier for each order.
product_id: A unique identifier for each product.
product_name: The name of the product.
aisle_id and aisle: The aisle number and name where the product is located.
department: The department name.
order_dow: The day of the week the order was placed.
order_hour_of_day: The hour of the day the order was placed.

```{r}
instacart |> 
  summarize(
    total_obs = n(),
    unique_users = n_distinct(user_id),
    unique_orders = n_distinct(order_id),
    unique_aisles = n_distinct(aisle)
  )

```

Take the contents of order ID `r instacart$order_id[1]` as an example. This customer ordered 8 items, including 'Bulgarian Yogurt', which is from the 'yogurt' aisle and 'dairy eggs' department. Within these 8 items, 'Bulgarian Yogurt','Organic 4% Milk Fat Whole Milk Cottage Cheese','Lightly Smoked Sardines in Olive Oil', 'Organic Whole String Cheese' have been ordered by this user in the past. And the order was placed on Friday at 10 a.m.There are 9 days since the last order.

## How many aisles are there, and which aisles are the most items ordered from?

```{r}

unique_aisles = instacart |> 
  summarize(unique_aisles = n_distinct(aisle))

aisle_counts = instacart |> 
  count(aisle, sort = TRUE)

unique_aisles
head(aisle_counts)

```

There are `r unique_aisles` unique aisles in the dataset. The top 5 most ordered-from aisles are "fresh vegetables", "fresh fruits", "packaged vegetables fruits", "yogurt", and "packaged cheese".

## The number of items ordered in each aisle.
```{r}
aisle_counts |> 
  filter(n > 10000) |> 
  mutate(aisle = fct_reorder(aisle, n)) |> 
  ggplot(aes(x = aisle, y = n)) +
  geom_col() +
  coord_flip() +
  labs(title = "Aisles with >10,000 Orders",
       x = "Aisle", y = "Number of Orders")

```


## The table shows the three most popular items in some of the aisles.
```{r}
instacart |> 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) |> 
  count(aisle, product_name, sort = TRUE) |> 
  group_by(aisle) |> 
  slice_max(n, n = 3) |> 
  knitr::kable()

```


## The mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week.
```{r}
instacart |> 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) |> 
  group_by(product_name, order_dow) |> 
  summarize(mean_hour = mean(order_hour_of_day)) |> 
  pivot_wider(names_from = order_dow, values_from = mean_hour) |> 
  knitr::kable(digits = 2)

```

The table indicates that, on average, Coffee Ice Cream is ordered later in the day than Pink Lady Apples across all days of the week. Both products tend to be ordered in the early to mid-afternoon (13:00-15:00).





















